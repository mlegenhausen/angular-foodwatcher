"use strict";var app=angular.module("app",["ui.bootstrap"]).config(["$httpProvider",function(a){a.responseInterceptors.push("HttpLoadingInterceptor")}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",resolve:{mensas:["Mensa",function(a){return a.getAll()}]}}).when("/mensa/:id",{templateUrl:"views/mensa.html",controller:"MensaCtrl",resolve:{mensa:["$route","Mensa",function(a,b){return b.get(a.current.params.id)}],isClosed:["Mensa",function(a){return a.isClosed()}],nextMonday:["DateTime",function(a){return a.getNextMonday()}]}}).otherwise({redirectTo:"/"})}]);"use strict",app.controller("AppCtrl",["$scope","$route","Mensa",function(a,b,c){a.mensas=c.getAll(),a.loading=!1,a.$on("event:http:loading",function(){a.loading=!0}),a.$on("event:http:loaded",function(){a.loading=!1}),a.$on("$routeChangeError",function(b,c){a.mensaError=a.mensas.then(function(a){return a[c.params.id]})}),a.$on("$routeChangeStart",function(){a.mensaError=null}),a.refresh=function(){c.clear(),b.reload()}}]),"use strict",app.controller("MainCtrl",["$scope","mensas",function(a,b){a.mensas=b}]),"use strict",app.controller("MensaCtrl",["$scope","mensa","isClosed","nextMonday",function(a,b,c,d){a.mensa=b,a.isClosed=c,a.nextMonday=d}]),app.directive("navActive",["$rootScope","$location","$timeout",function(a,b,c){return{link:function(d,e,f){function g(){e.toggleClass("active",f.navActive===b.path())}a.$on("$routeChangeSuccess",g),c(g)}}}]),app.directive("typeIcon",function(){var a={86:"vegetarian",80:"vegan",87:"game",83:"pig",70:"fish",82:"beef",71:"chicken",76:"lamb",79:"spacer"};return{template:'<img ng-src="{{path}}" ng-show="path"/>',replace:!0,restrict:"E",scope:{type:"="},link:function(b,c,d){var e=a[b.type];b.path=e?"images/"+e+".png":null}}}),"use strict",app.factory("HttpLoadingInterceptor",["$rootScope","$q",function(a,b){var c=0;return function(d){return c===0&&a.$broadcast("event:http:loading"),c++,d.then(function(b){return c--,c===0&&a.$broadcast("event:http:loaded"),b},function(d){return c--,c===0&&a.$broadcast("event:http:loaded"),b.reject(d)})}}]),app.service("DateTime",function(){this.getCurrentWeek=function(){return moment().week()},this.getCurrentYear=function(){return moment().years()},this.getCurrentDay=function(){return moment().day()},this.getDaysOfWeek=function(a,b,c){return moment().years(a).week(b).day(c+1).toDate()},this.getNextMonday=function(){var a=this.getCurrentWeek()+1;return moment().week(a).day(1).toDate()}}),"use strict",app.service("Mensa",["$q","$http","persistenceCache","DateTime",function(a,b,c,d){var e=c("mensa"),f={air:{name:"Airport",title:"Mensa am Airport"},bhv:{name:"Bremerhaven",title:"Mensa in Bremerhaven"},gw2:{name:"Cafeteria GW2",title:"Cafeteria GW2 in der Uni"},hsb:{name:"Neustadtwall",title:"Mensa am Neustadtwall"},uni:{name:"Uniboulevard",title:"Mensa am Uniboulevard"},wer:{name:"Werderstrasse",title:"Mensa in der Werderstrasse"}};this.get=function(c){var g=d.getCurrentYear(),h=d.getCurrentWeek(),i=[c,g,h].join(":"),j=e.get(i);return j?a.when(j):b({method:"JSONP",url:"http://foodspl.appspot.com/mensa",params:{format:"json",year:g,week:h,id:c,callback:"JSON_CALLBACK"}}).then(function(a){var b=a.data;return angular.extend(b,f[c]),angular.forEach(b.menues,function(a,b){var c=d.getCurrentDay()-1;a.date=d.getDaysOfWeek(g,h,b),a.active=c===b||b===4&&c>4}),e.put(i,b),b})},this.getAll=function(){return a.when(f)},this.isClosed=function(){return d.getCurrentDay()>5},this.clear=function(){e.removeAll()}}]),app.factory("persistenceCache",["$cacheFactory",function(a){return function(b,c){var d={name:b,adapter:"dom"},e=a(b,c),f=new Lawnchair(d,function(a){a.all(function(b){b.forEach(function(a){e.put(a.key,a.value)});var c=e.put;e.put=function(b,d){return a.save({key:b,value:d}),c(b,d)}})}),g=e.removeAll;return e.removeAll=function(){return f.nuke(),g()},e}}]);